# STM32蓝牙调试专用版本说明

## 当前配置状态
- ✅ ENABLE_BLUETOOTH = 1 (蓝牙启用)
- ❌ ENABLE_DHT11 = 0 (温湿度传感器禁用)
- ❌ ENABLE_MPU6050 = 0 (陀螺仪禁用) 
- ❌ ENABLE_MQ2 = 0 (烟雾传感器禁用)
- ❌ ENABLE_LIGHT = 0 (光敏电阻禁用)
- ❌ ENABLE_BREATHING = 0 (呼吸灯禁用)
- ❌ ENABLE_ALARM = 0 (报警功能禁用)

## 调试修改内容

### 1. 蓝牙初始化简化
- 增加了更长的等待时间（1000ms）
- 简化初始化消息
- 增加LCD显示状态反馈

### 2. 强制测试消息
- 主循环每秒自动发送测试消息：`TEST: 秒数`
- 用于验证蓝牙发送功能是否正常

### 3. 简化心跳包
- 从10秒改为5秒间隔
- 简化消息内容：`ALIVE: 计数器`

### 4. 简化命令处理
- 接收到命令后立即回复：`GOT: 命令内容`
- 支持简单命令：
  - 命令`1`：回复`CMD1: OK`
  - 命令`9`：回复`STATUS: BT Working`
  - 其他：回复`UNKNOWN`

## 预期调试结果

### 如果蓝牙发送正常
应该能看到：
```
=== BT TEST START ===
Smart Agriculture v2.0
Commands: 1-9, 0
=== BT TEST END ===
TEST: 1
TEST: 2
TEST: 3
...
ALIVE: 50
ALIVE: 100
...
```

### 如果蓝牙接收正常
发送命令`1`应该收到：
```
GOT: 1
CMD1: OK
```

发送命令`9`应该收到：
```
GOT: 9
STATUS: BT Working
```

## 可能的问题原因

### 1. 如果完全没有输出
- 硬件连接问题（TX/RX线路）
- 波特率不匹配（当前设置9600）
- UART2初始化失败
- 蓝牙模块供电问题

### 2. 如果有输出但无法接收命令
- RX接收线路问题
- UART2中断未正确配置
- 中断处理函数问题

### 3. 如果接收正常但处理异常
- bt_command_ready标志问题
- 命令缓冲区问题

## 硬件检查要点

### UART2引脚配置
- TX: PA2 (输出到蓝牙模块RX)
- RX: PA3 (接收蓝牙模块TX)  
- 波特率: 9600
- 数据位: 8
- 停止位: 1
- 校验位: 无

### 蓝牙模块连接
- VCC -> 3.3V/5V
- GND -> GND
- TX -> PA3 (STM32的RX)
- RX -> PA2 (STM32的TX)

## 下一步调试建议

1. **首先确认发送功能**：上电后应该立即看到测试消息
2. **确认接收功能**：尝试发送简单命令如`1`或`9`
3. **检查硬件连接**：确认TX/RX线没有接反
4. **检查波特率**：确认蓝牙设备和STM32都设置为9600
5. **使用串口调试工具**：如串口调试助手验证通信

## 恢复完整功能
调试完成后，将其他模块开关改回1即可恢复完整功能。
