# STM32智慧农业蓝牙命令使用说明

## 1. 命令格式

**重要：所有命令必须使用两位数格式**

- 正确格式：`01`, `02`, `03`, `09`, `00`
- 错误格式：`1`, `2`, `3`, `9`, `0`

## 2. 支持的命令列表

| 命令 | 功能 | 说明 |
|------|------|------|
| `01` | 设置温度高阈值为35℃ | 温度超过35℃时触发报警 |
| `02` | 设置温度低阈值为15℃ | 温度低于15℃时触发报警 |
| `03` | 设置湿度高阈值为80% | 湿度超过80%时触发报警 |
| `04` | 设置湿度低阈值为30% | 湿度低于30%时触发报警 |
| `05` | 设置光照低阈值为30% | 光照低于30%时触发报警 |
| `06` | 设置烟雾高阈值为200ppm | 烟雾浓度超过200ppm时触发报警 |
| `07` | 启用报警并强制测试 | 重新启用报警功能并触发测试 |
| `08` | 禁用所有报警 | 关闭所有报警和蜂鸣器 |
| `09` | 查询当前状态 | 显示详细的系统状态信息 |
| `00` | 恢复默认阈值 | 将所有阈值恢复为出厂设置并启用报警 |

## 3. 使用方法

### 3.1 连接蓝牙
1. 打开蓝牙调试工具（如串口助手、蓝牙调试APP等）
2. 连接到STM32的蓝牙模块（波特率：9600）
3. 系统会发送欢迎信息和命令帮助

### 3.2 发送命令
1. 在蓝牙工具中输入两位数命令，如：`01`
2. 发送命令（通常按回车键或点击发送按钮）
3. 系统会立即回复确认信息

### 3.3 命令反馈
每个命令都会收到以下反馈：
```
>>> ACK: Command received at 123s <<<
RAW COMMAND: [01] (length=2)
>>> COMMAND RECEIVED: 01 <<<
SUCCESS: Temperature High = 35C (CMD:01)
>>> COMMAND 01 COMPLETED <<<
```

## 4. 状态查询示例

发送命令：`09`

回复示例：
```
=== SYSTEM STATUS (CMD:09) ===
Temperature: 25C (Range: 15-35)
Humidity: 60% (Range: 30-80)
Light: 50% (Min: 30)
Smoke: 45ppm (Max: 200)
Alarms: NONE | Disabled: NO
Sensors: DHT11=OK MPU6050=OFF Light=OK
=== STATUS QUERY COMPLETE ===
```

## 5. 调试信息

系统每30秒会自动发送生存信号：
```
ALIVE: System OK [123]
```

## 6. 常见问题

### Q1: 发送命令没有反应？
- 检查蓝牙连接是否正常
- 确保使用两位数格式（如`01`而不是`1`）
- 检查波特率是否为9600

### Q2: 命令格式错误？
- 所有命令必须是两位数：00-09
- 不支持单数字命令
- 不支持字母或特殊字符

### Q3: 如何测试蜂鸣器？
- 发送命令`07`启用报警并触发测试
- 发送命令`08`关闭蜂鸣器

### Q4: 如何恢复默认设置？
- 发送命令`00`恢复所有阈值为默认值

## 7. LCD显示提示

执行命令时，LCD屏幕会短时显示确认信息：
- `TempHigh: 35C` - 温度高阈值已设置
- `Alarms DISABLED` - 报警已禁用
- `Reset & ENABLED` - 已恢复默认并启用报警

## 8. 技术参数

- 蓝牙波特率：9600 bps
- 命令长度：2字节（不含结束符）
- 响应时间：< 100ms
- 支持命令数：10个（00-09）
- 心跳间隔：30秒
