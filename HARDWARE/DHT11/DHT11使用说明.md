# DHT11温湿度传感器驱动使用说明

## 1. 功能概述

本驱动实现了DHT11数字温湿度传感器的完整功能，可以实时读取环境温度和湿度数据，并在LCD1602显示屏上显示。

## 2. 硬件连接

- **DHT11 DATA引脚** → **STM32F407 PE5引脚**
- **DHT11 VCC引脚** → **3.3V或5V电源**
- **DHT11 GND引脚** → **GND**

## 3. 文件结构

- `DHT11.h` - DHT11驱动头文件
- `DHT11.c` - DHT11驱动实现文件
- `main.c` - 主程序，包含DHT11和LCD显示功能

## 4. 主要功能

### 4.1 核心函数

- `dht11_init()` - DHT11初始化，返回0表示成功，1表示失败
- `dht11_read_data()` - 读取温湿度数据，返回0表示成功，1表示失败
- `dht11_temp` - 全局变量，存储温度值（摄氏度）
- `dht11_humi` - 全局变量，存储湿度值（%RH）

### 4.2 通信协议

DHT11使用单总线协议通信：

1. **开始信号**：主机拉低数据线至少18ms，然后拉高20-40us
2. **响应信号**：DHT11拉低80us，然后拉高80us
3. **数据传输**：40位数据，包含湿度整数+湿度小数+温度整数+温度小数+校验和
4. **数据位编码**：
   - 数据0：50us低电平 + 26-28us高电平
   - 数据1：50us低电平 + 70us高电平

## 5. 使用示例

```c
#include "DHT11.h"
#include "lcd.h"

int main(void)
{
    char temp_str[16], humi_str[16];
    
    // 初始化LCD和DHT11
    lcd_init();
    dht11_init();
    
    while(1)
    {
        // 读取温湿度数据
        if(dht11_read_data() == 0)
        {
            // 格式化并显示数据
            sprintf(temp_str, "Temp: %d C", dht11_temp);
            sprintf(humi_str, "Humi: %d %%RH", dht11_humi);
            
            lcd_gotoxy(0, 0);
            lcd_print_str(temp_str);
            
            lcd_gotoxy(1, 0);
            lcd_print_str(humi_str);
        }
        
        delay_ms(2000);  // 延时2秒
    }
}
```

## 6. LCD显示格式

- **第一行**：`Temp: XX C` - 显示温度（摄氏度）
- **第二行**：`Humi: XX %RH` - 显示湿度（相对湿度百分比）

## 7. 状态指示

- **LED0闪烁**：DHT11读取正常
- **LED0常亮**：DHT11读取失败
- **LCD显示"Read Error!"**：传感器读取失败
- **LCD显示"DHT11 Error!"**：传感器初始化失败

## 8. 注意事项

1. **延时函数**：为避免与其他模块冲突，使用了独立的延时函数
2. **读取频率**：DHT11响应较慢，建议读取间隔至少2秒
3. **数据校验**：每次读取都进行校验和验证，确保数据准确性
4. **电源要求**：DHT11可使用3.3V或5V供电
5. **环境条件**：
   - 湿度测量范围：20-90%RH（±5%RH精度）
   - 温度测量范围：0-50°C（±2°C精度）

## 9. 故障排除

### 9.1 初始化失败
- 检查硬件连接
- 确认电源供电正常
- 检查PE5引脚配置

### 9.2 读取数据失败
- 检查DHT11是否正常供电
- 确认读取间隔足够（≥2秒）
- 检查数据线连接是否稳定

### 9.3 数据异常
- 校验和错误通常表示通信干扰
- 可以增加读取间隔时间
- 检查周围是否有强电磁干扰

## 10. 技术参数

- **供电电压**：3.3V-5.5V DC
- **供电电流**：测量时平均0.5mA，待机0.02mA
- **输出**：单总线数字信号
- **测量范围**：湿度20-90%RH，温度0-50°C
- **测量精度**：湿度±5%RH，温度±2°C
- **分辨率**：湿度1%RH，温度1°C
- **响应时间**：<2s

## 11. 版本信息

- **版本**：1.0
- **作者**：Mika
- **日期**：2025-06-30
- **适用平台**：STM32F407
