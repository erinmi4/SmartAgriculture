# MQ-2烟雾传感器实现说明（简化版）

## 问题解决

### 1. 延时函数问题
- **问题**: 使用了不存在的 `delay_init()` 和 `delay_ms()` 函数
- **解决**: 使用 `delay.c` 中实际存在的 `Mdelay_Lib()` 函数

### 2. 链接错误问题
- **问题**: MQ2模块函数未定义（因为mq2.c未添加到编译）
- **解决**: 将所有MQ2功能直接实现在main.c中，避免链接问题

## 实现方案

### 文件结构
```
├── main.c                   - 包含所有MQ-2功能的主程序
├── delay.c/.h              - 延时函数模块
├── uart.c/.h               - UART通信模块
└── lcd.c/.h                - LCD显示模块
```

### 主要功能
1. **MQ-2传感器初始化**: 配置USART3，波特率9600
2. **发送检测命令**: `{0xFF, 0x01, 0x86, 0x00, 0x00, 0x00, 0x00, 0x00, 0x79}`
3. **接收和解析数据**: 9字节响应帧，解析烟雾浓度
4. **LCD显示**: 实时显示浓度值和状态

### 关键函数
- `MQ2_Init()` - 初始化USART3
- `MQ2_SendCommand()` - 发送检测命令
- `MQ2_ProcessData()` - 处理接收数据（由UART中断调用）
- `MQ2_GetValue()` - 获取浓度值
- `MQ2_IsDataReady()` - 检查数据是否就绪
- `MQ2_ClearFlag()` - 清除就绪标志

### 显示格式
```
LCD第一行: Smoke:XXXX ppm
LCD第二行: Status: Normal/Low/Medium/HIGH!!!
```

### 状态分级
- **Normal**: < 100 ppm
- **Low**: 100-300 ppm  
- **Medium**: 300-500 ppm
- **HIGH!!!**: > 500 ppm

## 使用方法

1. **编译**: 确保main.c在编译列表中
2. **硬件连接**: 
   - MQ-2传感器 → USART3 (PB10-TX, PB11-RX)
   - LCD1602 → 按lcd.h定义连接
3. **运行**: 上电后自动开始检测，2秒更新一次

## 注意事项

1. **延时函数**: 使用 `Mdelay_Lib()` 而不是不存在的函数
2. **一体化设计**: 所有功能在main.c中，避免链接问题
3. **中断处理**: UART中断自动调用 `MQ2_ProcessData()`
4. **数据校验**: 通过帧头0xFF识别数据帧开始

这个版本解决了所有链接错误和延时函数问题，可以直接编译运行！
